<!DOCTYPE html>
<html moznomarginboxes=""><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>Unit 5: Key Events</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="bootstrap.css" title="default"/><link rel="stylesheet" type="text/css" href="pretty-printing.css" title="default"/><link rel="stylesheet" type="text/css" href="codemirror.css" title="default"/><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="textbook.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="codemirror.js"></script><script type="text/javascript" src="runmode.js"></script><script type="text/javascript" src="scheme2.js"></script><script type="text/javascript" src="pyret-mode.js"></script><script type="text/javascript" src="bootstraplesson.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML%2Chttp%3A%2F%2Fwww.cs.wpi.edu%2F%7Ekfisler%2Fmathjaxlocal.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="mature"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;">&bull;</td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Unit 5:<span class="mywbr"> &nbsp;</span> Key Events</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Unit_5__.Key_.Events%29" class="tocsubseclink" data-pltdoc="x">Unit 5:<span class="mywbr"> &nbsp;</span> Key Events</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><a name="(part._.Unit_5__.Key_.Events)"></a><p><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script><noscript></noscript><script type="text/javascript" src="easyXDM.min.js"></script><noscript></noscript><script type="text/javascript" src="json2.min.js"></script><noscript></noscript><script type="text/javascript" src="wescheme-embedded.js"></script><noscript></noscript><script type="text/javascript" src="bootstrap-helpers.js"></script><noscript></noscript></p><div class="headercontent"><span class="BootstrapTitle"><img src="pict.png" alt="image" width="150" height="150"/><span class="TitleUnitNum">Unit 5</span>Key Events</span></div><div class="SubFlow" id="overviewDescr"><span class="BootstrapHeader">Unit Overview</span><p>Students are introduced to another type of event, called on-key. They define a key-event handler that modifies a reactor
state to move a character when certain keys are pressed. To handle multiple possible keys, students return to the subject
of piecewise functions, giving them more practice with Pyret&rsquo;s if expressions.</p></div><blockquote class="OverviewBoundary"><iframe id="forum_embed"></iframe><div class="summary"><div class="" id="BootstrapAgenda"><p>Agenda</p><ul class="BootstrapAgendaList"><li class="BootstrapAgendaListItem"><p><span class="BSLessonDuration">45 min</span><a href="#lesson_2dCharacterMovement35844"><span class="BSLessonName">2d Character Movement</span></a></p></li><li class="BootstrapAgendaListItem"><p><span class="BSLessonDuration">45 min</span><a href="#lesson_CombiningTicksandKeypresses35845"><span class="BSLessonName">Combining Ticks and Keypresses</span></a></p></li></ul></div><p><span href="../../../../reactive/english/units/unit5/index.html" class="TranslationButton">English</span></p><p><span href="#" class="TranslationButton">add translation</span></p><div id="ProductOutcomes" class=" "><span class="BootstrapHeader">Product Outcomes:</span><ul><li><p>Students implement the entire Sam the Butterfly activity from Bootstrap:Algebra with a character of their choice</p></li><li><p>Students build the interactive parts of a simple game</p></li></ul></div><div id="LearningObjectives" class=" "><span class="BootstrapHeader">Standards and Evidence Statements:</span><p>Standards with prefix BS are specific to Bootstrap; others are from the Common Core. Mouse over each standard to see its corresponding evidence statements. Our <a href="http://www.bootstrapworld.org/materials/Standards.shtml" target="_blank">Standards Document</a> shows which units cover each standard. </p><ul class="LearningObjectivesList"><li class="LearningObjectivesListItem"><div class="LearningObjectivesListItemContents"><p><span style="font-weight: bold">BS-DS.1</span>: The student is able to read data blocks</p><ul class="EvidenceStatementsList"></ul></div></li><li class="LearningObjectivesListItem"><div class="LearningObjectivesListItemContents"><p><span style="font-weight: bold">BS-DS.2</span>: The student is able to solve problems using data structures</p><ul class="EvidenceStatementsList"></ul></div></li><li class="LearningObjectivesListItem"><div class="LearningObjectivesListItemContents"><p><span style="font-weight: bold">BS-R</span>: The student is able to write interactive programs using the &rsquo;Reactor&rsquo; construct</p><ul class="EvidenceStatementsList"></ul></div></li></ul></div><span class="BootstrapHeader">Length: 90 Minutes</span><div id="Glossary" class=" "><span class="BootstrapHeader">Glossary:</span><ul><li><p><span class="vocab">event</span>: something that happens outside of a running program, which the program can respond to</p></li><li><p><span class="vocab">handler</span>: Connects an event (like a tick or keypress) and a function within a reactor</p></li><li><p><span class="vocab">reactor</span>: A value that contains a current state, and functions for updating, drawing, and interacting with that state</p></li></ul></div><div id="Materials" class=" "><span class="BootstrapHeader">Materials:</span><ul><li><p>Pens/pencils for the students, fresh whiteboard markers for teachers</p></li><li><p>Class poster (List of rules, design recipe, course calendar)</p></li><li><p>Editing environment (Pyret Editor)</p></li><li><p>Student workbooks</p></li><li><p>Language Table</p></li></ul></div><div id="Preparation" class=" "><span class="BootstrapHeader">Preparation:</span><ul><li><p>The <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVVWk4MGJidEtsRWc" target="_blank">Moving Character</a> file preloaded on students&rsquo; machines</p></li><li><p>The <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVXy00M1VteEZxaHM" target="_blank">Virtual Pet Starter</a> file preloaded on students&rsquo; machines</p></li></ul></div><div id="LanguageTable" class=" "><table cellspacing="0" cellpadding="0" class="thetable"><tr><td align="center" class="BootstrapTable"><p class="BootstrapTableHeader">Types</p></td><td align="center" class="BootstrapTable"><p class="BootstrapTableHeader">Functions</p></td><td align="center" class="BootstrapTable"><p class="BootstrapTableHeader">Values</p></td></tr><tr><td align="center" class="BootstrapTable"><p>Number</p></td><td align="center" class="BootstrapTable"><p><tt class="pyret">+ - * / num-sqr num-sqrt</tt></p></td><td align="center" class="BootstrapTable"><p>1 ,4 ,44.6</p></td></tr><tr><td align="center" class="BootstrapTable"><p>String</p></td><td align="center" class="BootstrapTable"><p><tt class="pyret">string-append string-length</tt></p></td><td align="center" class="BootstrapTable"><p> "hello" </p></td></tr><tr><td align="center" class="BootstrapTable"><p>Image</p></td><td align="center" class="BootstrapTable"><p><tt class="pyret">rectangle circle triangle ellipse star text scale rotate put-image</tt></p></td><td align="center" class="BootstrapTable"><p>circle(25, "solid", "red")</p></td></tr></table></div><p><div id="lessonToolbar" class="fixed"><input type="button" valueShow="Show Teacher Notes" valueHide="Hide Teacher Notes" value="Show Teacher Notes" onclick="toggleTeacherNotes(this);"></input><br/><input type="button" value="Discussion Group" onclick="showGroup()"/><br/><input type="button" value="Slides" onclick="showSlides()"/></div></p></div></blockquote><blockquote class="LessonBoundary"><div class="BootstrapPageTitle">2d Character Movement</div><div class="content"><div class="overview"><span class="BootstrapLogo"><p><img src="logo.png" alt="bootstrap logo" width="150" height="150"/></p></span><span class="BootstrapLessonTitle"><span class="BSLessonName"><p>Overview</p></span></span><div class="LessonLearningObjectives"><p><span style="font-weight: bold">Learning Objectives</span></p><ul><li><p>Students learn how to connect keypress events with their functions</p></li><li><p>Students get practice with piecewise functions</p></li></ul></div><div class="LessonEvidenceStatementes"><p><span style="font-weight: bold">Evidence Statementes</span></p><ul></ul></div><div class="LessonProductOutcomes"><p><span style="font-weight: bold">Product Outcomes</span></p><ul><li><p>Students implement the entire Sam the Butterfly activity from Bootstrap:Algebra with a character of their choice</p></li></ul></div><div class="LessonMaterials"><p><span style="font-weight: bold">Materials</span></p><ul><li><p>Pens/pencils for the students, fresh whiteboard markers for teachers</p></li><li><p>Class poster (List of rules, design recipe, course calendar)</p></li><li><p>Editing environment (Pyret Editor)</p></li><li><p>Student workbooks</p></li><li><p>Language Table</p></li></ul></div><div class="LessonPreparation"><p><span style="font-weight: bold">Preparation</span></p><ul><li><p>The <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVVWk4MGJidEtsRWc" target="_blank">Moving Character</a> file preloaded on students&rsquo; machines</p></li></ul></div></div><div class="segment"><p><a name="lesson_2dCharacterMovement35844"></a><span></span></p><span class="BootstrapLessonTitle"><span class="BSLessonName"><span class="Slide-Lesson-Title">2d Character Movement</span>



<span class="time">(Time 45 minutes)</span>

</span><p></p></span><ul class="lesson"><li class="lessonItem"><div class="student"><p><span class="slideText"><span class="BootstrapSlideTitle">2d Character Movement</span></span>
  We&rsquo;ve already seen one kind of interactivity in our programs: getting
  the next state from the current state on a tick-event. This is perfect for
  animations that happen on their own, without any user intervention. In a game,
  that might be clouds moving across the sky or a ball bouncing on its own.
  An important kind of behavior in <span style="font-style: italic">interactive</span> programs is to respond
  user input, such as keypresses. A keypress, like the <tt class="pyret">tick</tt> of a clock,
  is a kind of <span class="vocab">event</span>, and we&rsquo;ll re-use the idea of an event <span class="vocab">handler</span>
  like <tt class="pyret">on-tick</tt> and a function like <tt class="pyret">next-state-tick</tt>. For key-events,
  the event handler is called <tt class="pyret">on-key</tt>, and our function
  <tt class="pyret">next-state-key</tt> will compute the next state from the current one after a
  key event.  We&rsquo;re going to use this idea to build up a <span class="vocab">reactor</span> with a character
  moving in two dimensions, where the movement is triggered by keypresses.</p><div class="activity"><p>Open up the <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVVWk4MGJidEtsRWc" target="_blank">Moving
  Character</a> template file.</p></div><p>It contains a data block for representing a character&rsquo;s position
  (<tt class="pyret">CharState</tt>) that has an x and y position.</p><div class="activity"><p>Write an example instance of a <tt class="pyret">char-state</tt> where both the <tt class="pyret">x</tt>
field and the <tt class="pyret">y</tt> field are between 100 and 500.  Give it the name
<tt class="pyret">middle</tt>.</p></div><p>We&rsquo;ve filled in a picture of Sam the Butterfly from Bootstrap:Algebra. There is a
  drawing function called <tt class="pyret">draw-state</tt> provided that simply draws the
  character image on a white background at the x and y coordinate in a
  <tt class="pyret">CharState</tt>.</p><div class="activity"><p>Run the program, and use <tt class="pyret">draw-state</tt> to draw the example instance you
created above.  Did it appear where you expected?</p></div><p>This is a reminder that it&rsquo;s often useful, when working on programs that use
data to represent positions in an image, to make sure we understand what values
in the data structure correspond to which drawing behavior.</p><div class="activity"><p>Write an example instance that represents the butterfly in the top-right corner of
the window.  Give it a meaningful name of your own choice.  Re-run the
program, and check using <tt class="pyret">draw-state</tt> that it showed up where you
expect.</p></div><p>There is also a contract for a function <tt class="pyret">next-state-key</tt>, which looks
  like:</p><p>&nbsp;<textarea class="pyret">
# next-state-key :: CharState, String -&gt; CharState
# Moves the character by 5 pixels
# in the corresponding direction
# if an arrow key ("up", "left", "down", or "right")
# is pressed, &amp; leaves the character in place otherwise
</textarea></p><div class="activity"><p>How does the contract of <tt class="pyret">next-state-key</tt> differ from the contract of
<tt class="pyret">next-state-tick</tt> in your previous programs?</p></div><p>It is different from the contract for <tt class="pyret">next-state-tick</tt> (which handles
  tick events) in an important way.  When a key event happens, the next state
  may differ depending on <span style="font-style: italic">which</span> key was pressed.  That means the
  <tt class="pyret">next-state-key</tt> function needs both the current state <span style="font-style: italic">and</span> which key was
  pressed as parts of its domain.  That&rsquo;s why <tt class="pyret">next-state-key</tt> has an
  additional <tt class="pyret">String</tt> input, which represents the key pressed by the
  user.</p><div class="activity"><p>Create an example instance that corresponds to the position 5 pixels to the
<span style="font-style: italic">right</span> of the example instance you wrote above.  Use <tt class="pyret">draw-state</tt> to
check it, as before.</p></div><p>This gives us a good input and output test for the examples block when working
on <tt class="pyret">next-state-key</tt>.  What call to <tt class="pyret">next-state-key</tt> should connect
these two example instances?</p><div class="activity"><p>Use the Design Recipe to fill in your examples and definition of
<tt class="pyret">next-state-key</tt>.  Use the sample instances you created before in
the examples block.</p></div></div><div class="teacher"><p>It&rsquo;s an important point that <tt class="pyret">next-state-key</tt> takes in an extra
piece of information: the pressed key.  This makes it much richer in terms of
its purpose statement, which should describe what different keys ought to do to
the state of the reactor.</p><p>Students will create something like <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVTUtoekI2XzE3Znc" target="_blank">this completed file</a> by adding a
next-state-key function</p></div></li><li class="lessonItem"><div class="student"><div class="activity"><p>Once you&rsquo;ve implemented <tt class="pyret">next-state-key</tt>, experiment with it in the interactions pane:</p><ul><li><p>Try <tt class="pyret">draw-state(next-state-key(middle, "left"))</tt>.  How is the
output different from <tt class="pyret">draw-state(middle)</tt>?</p></li><li><p>Try using a few different calls to <tt class="pyret">next-state-key</tt> to move the
character several times, then draw it.  For example:</p><p>&nbsp;<textarea class="pyret">
draw-state(next-state-key(next-state-key(middle, "left"), "up"))
</textarea></p></li></ul></div><p>As with ticks-events, we can manually pass keypress strings into
  this function, see what the next state would be, and even draw that state
  to see what it looks like.  That&rsquo;s great, but we still want to hook
  this function up to a reactor, so that it actually handles
  keypresses from a user playing the game.  To do this, we need to create a
  reactor use <tt class="pyret">on-key</tt> to specify that our <tt class="pyret">next-state-key</tt> function
  should be called when the user presses a key (we don&rsquo;t need to specify an
  <tt class="pyret">on-tick</tt> handler, since for now the only movement in our program comes
  from keypresses). Our reactor with a <tt class="pyret">to-draw</tt> and <tt class="pyret">on-key</tt> handler
  looks like this:</p><p>&nbsp;<textarea class="pyret">
char-react = reactor:
  init: middle,
  to-draw: draw-state,
  on-key: next-state-key
end
</textarea></p><div class="activity"><p>Make your program create a reactor by that uses the <tt class="pyret">on-key</tt> handler with
the <tt class="pyret">next-state-key</tt> function you just implemented.  Run the program and
use <tt class="pyret">interact(char-react)</tt> to start the reactor.  Does it work the way you
expected?  If it doesn&rsquo;t, check:</p><ul><li><p>Does the program have any typos or syntax errors?</p></li><li><p>Do the examples of <tt class="pyret">next-state-key</tt> match what you expect, creating
a new <tt class="pyret">char</tt> instance with appropriate <tt class="pyret">x</tt> and <tt class="pyret">y</tt> values?</p></li><li><p>Do the examples pass the implementation of <tt class="pyret">next-state-key</tt>?</p></li><li><p>Did you remember to add <tt class="pyret">on-key</tt> to the reactor?</p></li><li><p>Did you remember to re-run the program and use <tt class="pyret">interact</tt> to start
the animation?</p></li></ul></div><p>With this working, you can see the behind-the-scenes work that was going on in
Sam the Butterfly from Bootstrap:Algebra.  To get to the same point as in
Bootstrap:Algebra, we&rsquo;d next implement <tt class="pyret">is-onscreen</tt> to check if Sam has left
the board, and use it in <tt class="pyret">next-state-tick</tt>.</p></div><div class="teacher"><p> Act out a reactor with key-events. You will need four students: one who
acts as the <tt class="pyret">next-state-key</tt> function, one who acts as the keyboard (you
could also have the class act as a keyboard by having students shout out keys),
one who acts as the reactor, and one who acts as the <tt class="pyret">draw-state</tt> function. Give
each student a few sheets of paper and something to write with.</p><ul><li><p>When a key is "pressed" by the keyboard, the reactor write the current
state and the key that was pressed, then shows their paper to <tt class="pyret">next-state-key</tt>.</p></li><li><p><tt class="pyret">next-state-key</tt> produces a new state based on the current state and the key,
writes it down, and then hands the new state back to the reactor.</p></li><li><p>The reactor <span style="font-style: italic">discards</span> their old state, replacing it with the
new one, and shows the new one to <tt class="pyret">draw-state</tt>.</p></li><li><p><tt class="pyret">draw-state</tt> produces an image for the reactor to post, and draws it on paper.
They hand the image to the reactor, who holds it up as the new frame in the animation.</p></li></ul><p>We recommend <span style="font-weight: bold">not</span> having a <tt class="pyret">next-state-tick</tt> function for this activity,
to keep the focus on key events.  You can add a <tt class="pyret">on-tick</tt> handler in
a separate stage when talking through games which have both time- and key-based
events.</p></div></li><li class="lessonItem"><div class="student"><p>Optional: implement boundaries to keep character onscreen, using the same
ideas as <tt class="pyret">safe-left</tt> and <tt class="pyret">safe-right</tt> from before.  You can also
write <tt class="pyret">safe-top</tt> and <tt class="pyret">safe-bottom</tt>, and use all of them to keep the
character fully on the screen.</p><p>Optional: use <tt class="pyret">num-to-string</tt> and <tt class="pyret">text</tt> to display the
position at the top of the window.</p></div><div class="teacher"></div></li></ul></div></div></blockquote><blockquote class="LessonBoundary"><div class="BootstrapPageTitle">Combining Ticks and Keypresses</div><div class="content"><div class="overview"><span class="BootstrapLogo"><p><img src="logo.png" alt="bootstrap logo" width="150" height="150"/></p></span><span class="BootstrapLessonTitle"><span class="BSLessonName"><p>Overview</p></span></span><div class="LessonLearningObjectives"><p><span style="font-weight: bold">Learning Objectives</span></p><ul><li><p>Students see separate key and tick handlers combine to make a game</p></li><li><p>Students get practice with piecewise functions</p></li></ul></div><div class="LessonEvidenceStatementes"><p><span style="font-weight: bold">Evidence Statementes</span></p><ul></ul></div><div class="LessonProductOutcomes"><p><span style="font-weight: bold">Product Outcomes</span></p><ul><li><p>Students build the interactive parts of a simple game</p></li></ul></div><div class="LessonMaterials"><p><span style="font-weight: bold">Materials</span></p><ul><li><p>Pens/pencils for the students, fresh whiteboard markers for teachers</p></li><li><p>Class poster (List of rules, design recipe, course calendar)</p></li><li><p>Editing environment (Pyret Editor)</p></li><li><p>Student workbooks</p></li><li><p>Language Table</p></li></ul></div><div class="LessonPreparation"><p><span style="font-weight: bold">Preparation</span></p><ul><li><p>The <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVXy00M1VteEZxaHM" target="_blank">Virtual Pet Starter</a> file preloaded on students&rsquo; machines</p></li></ul></div></div><div class="segment"><p><a name="lesson_CombiningTicksandKeypresses35845"></a><span></span></p><span class="BootstrapLessonTitle"><span class="BSLessonName"><span class="Slide-Lesson-Title">Combining Ticks and Keypresses</span>



<span class="time">(Time 45 minutes)</span>

</span><p></p></span><ul class="lesson"><li class="lessonItem"><div class="student"><p><span class="slideText"><span class="BootstrapSlideTitle">Combining Ticks and Keypresses</span></span>
Now, you&rsquo;ve seen how to use functions to compute the next state in a game or
animation for both tick and key events.  We can combine these to make
an interactive "digital-pet" from scratch!</p><div class="activity"><p>Open the <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVXy00M1VteEZxaHM" target="_blank">Virtual Pet Starter</a> file.
Run it. You will see a frame come up, showing a cat face and green status bars for the cat&rsquo;s sleep and hunger.</p></div><p>Notice that not much is happening! To make this game more interesting, we want to
add three behaviors to it:</p><ul><li><p>as time passes, the hunger and sleep values should decrease</p></li><li><p>a human player should be able to increase hunger and sleep through keypresses</p></li><li><p>the image of the cat should change when hunger and sleep both reach 0 (and the player
loses the game)</p></li></ul><p>In this lesson, you will extend the animation three times, once for each of these behaviors, by
adding or changing the functions that make up an animation.
To do this, you will use the <span style="font-style: italic">Animation Extension Worksheet</span> three times.
Note that none of these should require adding any new fields
to the data definition, just adding and editing functions like
<tt class="pyret">next-state-tick</tt>, <tt class="pyret">next-state-key</tt>, and <tt class="pyret">draw-state</tt>.
We will walk you through the first use of the animation extension worksheet,
then let you try the other two on your own. </p></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p><div class="banner">Extension 1: Decrease Hunger and Sleep on Ticks</div>
                For this extension, we want to decrease
                the hunger by 2 and the sleep by 1 each time the animation ticks to a new frame.</p><div class="activity"><p>Open your workbook to <a href="../../resources/workbook/StudentWorkbook.pdf" target="_blank">Page 35</a>, which
shows you the extension worksheet filled in for this extension.</p></div><p>In this filled-in worksheet, the description from the problem is written down into the "goal" part
of the worksheet.  This is like the "purpose statement" for the feature.</p><div class="activity"><p>Think about what sketches you would draw to illustrate the animation
with this new behavior.  Then check out the ones we drew on the example
worksheet.  Notice that they focus on the bars having different lengths.</p></div></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p><div class="SIntrapara">Next, we consider the tables that summarize what now changes in the
animation.
</div><div class="SIntrapara"><div class="activity"><p>What changes between frames now that didn&rsquo;t in the starter file
for the virtual pet?</p></div></div><div class="SIntrapara">The worksheet identifies that both hunger and sleep are changing in new ways.  Since
they <span style="font-style: italic">aren&rsquo;t</span> new fields, this feature is completely dependent on existing
data, and we don&rsquo;t need to add any new fields. We therefore leave the second table
empty (since we aren&rsquo;t adding new fields).</div></p></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p>Next, we identify the components that we need to write or update. We don&rsquo;t
need to change the data definition at all, because no new fields were added. We
<span style="font-style: italic">may</span> need to update <tt class="pyret">draw-state</tt> function, since the size of the
bars changes.  We definitely need to write the <tt class="pyret">next-state-tick</tt> function,
which doesn&rsquo;t yet exist.  We do not need to address anything about keypresses
with this feature, so <tt class="pyret">next-state-key</tt> is untouched  Since
<tt class="pyret">next-state-tick</tt> has been added for this feature, we need to add a
<tt class="pyret">on-tick</tt> handler to the reactor.</p></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p>Now that we&rsquo;ve planned what work needs to be done (on paper), we can start
thinking about the code. As always, we write examples before we write functions,
so we are clear on what we are trying to do.</p><div class="activity"><p>Come up with two example instances of <tt class="pyret">PetState</tt> that
illustrate what should happen as we change the sleep and hunger fields.
You can see the ones we chose on the worksheet.  What&rsquo;s another good
example for us to use in coding and testing?</p></div><p>In our samples, we estimate a bit from looking at the pictures, but note
that we pick numbers that would work with the desired behavior &#8211; <tt class="pyret">MIDPET</tt>
represents the state after 25 ticks, because hunger is 50 less (decreased by 2
each tick), and sleep is 25 less (decreased by 1 on each tick).  The <tt class="pyret">LOSEPET</tt>
sample instance corresponds to the state when both hunger and sleep values are 0.</p><div class="activity"><p>Use your sample instances to write examples of the <tt class="pyret">next-state-tick</tt>
function, which we marked as a to-do item on the first page of the worksheet.</p></div></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p>Now we need to use this information to edit the current code,
                checking off the boxes we identified as we go.</p><div class="activity"><p>Look at the <tt class="pyret">draw-state</tt> function: how will it need to change to draw
boxes for the sleep and hunger values?</p></div><p>The <tt class="pyret">draw-state</tt> function already does this, so we can check the <tt class="pyret">draw-state</tt>
                changes off as being done (without doing additional work).</p><div class="activity"><p>Develop <tt class="pyret">next-state-tick</tt>, using the contract in the starter file
and the examples from the worksheet.</p></div><p>Once we&rsquo;ve finished using the design recipe to implement <tt class="pyret">next-state-tick</tt>, we can
                check off its box.  Finally, we need to add the handler to the <tt class="pyret">reactor</tt>
                so the reactor calls the function we just wrote on tick events.</p><div class="activity"><p>Edit the <tt class="pyret">pet-react</tt> reactor to include <tt class="pyret">next-state-tick</tt> alongside the
<tt class="pyret">on-tick</tt> handler.</p></div><p>You should have ended up with something like this:</p><p>&nbsp;<textarea class="pyret">
pet-react = reactor:
  init: FULLPET,
  on-tick: next-state-tick,
  to-draw: draw-state
end
</textarea></p><p>Make sure you get a working animation with bars that decrease before moving on,
                like this:</p><p><div class="banner"><img src="cat-decreasing-bars.gif" alt="" width="320" height="199"/></div></p></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p><div class="banner">Modification 2: Key Events</div>
Next, we&rsquo;ll add key events to the game so the player can increase them so they
don&rsquo;t reach zero!</p><div class="activity"><p>Turn to <a href="../../resources/workbook/StudentWorkbook.pdf" target="_blank">Page 37</a> in your workbook.
Fill in the first page to plan out the following extension:
On a keypress, if the user pressed "f" (for "feed"), <tt class="pyret">hunger</tt> should
increase by 10. If the user pressed "s" (for "sleep"), <tt class="pyret">sleep</tt> should
increase by 5.  If the user presses any other keys, nothing should change.</p></div><p>As you fill in the worksheet, think about useful sketches that capture this new feature,
whether you need new fields, and which functions are effected.</p><div class="activity"><p>When you&rsquo;ve implemented <tt class="pyret">next-state-key</tt>,
                            you can add it to the reactor at the bottom of the file with:</p><p>&nbsp;<textarea class="pyret">
pet-react = reactor:
  init: FULLPET,
  on-key: next-state-key,
  on-tick: next-state-tick,
  to-draw: draw-state
end
</textarea></p><p>and test out your game!</p></div></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p><div class="banner">Modification 3: Change Pet Image When Game is Lost</div></p><div class="activity"><p> When any bar reaches zero, the game is lost and your pet is sad &#8211;
 make the picture change to show the player this!  In addition, when the game is
 lost, the "f" and "s" keys shouldn&rsquo;t do anything.  Instead, the user should be
 able to press the "r" key (for "restart"), to reset hunger and sleep
 100, and start playing again. Use the animation-extension worksheet on
 <a href="../../resources/workbook/StudentWorkbook.pdf" target="_blank">Page 39</a> to plan out your changes.</p></div></div><div class="teacher"></div></li><li class="lessonItem"><div class="student"><p>You now know everything you need to build interactive games that react to the
keyboard, draw an image, and change over time!  These are the fundamentals of
building up an interactive program, and there are a lot of games, simulations,
or activities you can build already.  For example, you could build Pong, or the
extended Ninja Cat, a more involved Pet Simulator, a game with levels, and
much, much more.</p><p>Some of these ideas are more straightforward than others with what you know.
The rest of the workbook and units are designed to show you different
<span style="font-style: italic">features</span> that you can add to interactive programs.  You can work through
them all if you like, or come up with an idea for your own program, and try the
ones that will help you build your very own program!</p></div><div class="teacher"><p>Some next steps/optional activities if students finish these activities:</p><ul><li><p>Find your own images to create a different virtual pet</p></li><li><p>Stop the bars from overflowing some maximum. (produce something like <a href="https://code.pyret.org/editor#share=0B9rKDmABYlJVNTR6ajd4N1hPRm8" target="_blank">this completed game</a>)</p></li><li><p>Add an x-coordinate to the PetState so the pet moves around, either on keypress or based on clock ticks.</p></li><li><p>Add a costume to the PetState, then change the draw-pet function so that it changes the costume based on the pet&rsquo;s mood (if a-pet.hunger &lt;= 50, show a pic of the pet looking hungry)</p></li></ul></div></li></ul></div></div></blockquote><p></p><div id="copyright"><a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank"><img src="pict_2.png" alt="image" width="88" height="31"/></a>Bootstrap:Reactive by Emma Youndtsmith, Emmanuel Schanzer, Kathi Fisler, Shriram Krishnamurthi, and Joe Politz is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">Creative Commons 4.0 Unported License</a>. Based on a work at <a href="http://www.bootstrapworld.org/">www.BootstrapWorld.org</a>. Permissions beyond the scope of this license may be available by contacting <a href="mailto:schanzer@BootstrapWorld.org">schanzer@BootstrapWorld.org</a>.</div></div></div><div id="contextindicator">&nbsp;</div></body></html>